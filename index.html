<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de gerenciamento de estoque para tintas, papéis, tecidos e fornecedores">
    <title>Sistema de Estoque</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <style>
        body {
            min-height: 100vh;
            display: flex;
            background-color: #f8f9fa;
        }
        #sidebar {
            width: 250px;
            background-color: #343a40;
            color: white;
            min-height: 100vh;
            transition: transform 0.3s ease;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
        }
        #sidebar.active {
            transform: translateX(-250px);
        }
        #sidebar .nav-link {
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        #sidebar .nav-link:hover, #sidebar .nav-link.active {
            background-color: #495057;
        }
        #content {
            margin-left: 250px;
            padding: 20px;
            flex-grow: 1;
            transition: margin-left 0.3s ease;
        }
        #content.full {
            margin-left: 0;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .btn-custom {
            background-color: #007bff;
            color: white;
            transition: background-color 0.2s;
        }
        .btn-custom:hover {
            background-color: #0056b3;
        }
        .table-responsive {
            border-radius: 4px;
            overflow-x: auto;
        }
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 300px;
        }
        .hidden-form {
            display: none;
        }
        @media (max-width: 768px) {
            #sidebar {
                transform: translateX(-250px);
            }
            #sidebar.active {
                transform: translateX(0);
            }
            #content {
                margin-left: 0;
            }
            #content.full {
                margin-left: 0;
            }
        }
        .chart-container {
            max-width: 800px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav id="sidebar" role="navigation" aria-label="Menu de navegação principal">
        <div class="p-3">
            <h4 class="text-white mb-4">Menu</h4>
            <ul class="nav flex-column">
                <li class="nav-item"><a class="nav-link active" href="#" onclick="showSection('stock')"><i class="bi bi-box-seam me-2"></i>Estoque</a></li>
                <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('entry')"><i class="bi bi-arrow-down-circle me-2"></i>Entrada</a></li>
                <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('exit')"><i class="bi bi-arrow-up-circle me-2"></i>Saída</a></li>
                <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('suppliers')"><i class="bi bi-person-lines-fill me-2"></i>Fornecedores</a></li>
                <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('orders')"><i class="bi bi-cart me-2"></i>Pedidos</a></li>
                <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('charts')"><i class="bi bi-bar-chart me-2"></i>Gráficos</a></li>
                <li class="nav-item mt-4"><a class="nav-link text-danger" href="#" onclick="logout()"><i class="bi bi-box-arrow-left me-2"></i>Sair</a></li>
            </ul>
        </div>
    </nav>

    <!-- Content -->
    <div id="content" role="main">
        <button class="btn btn-dark mb-3 d-md-none" onclick="toggleSidebar()" id="toggleSidebar" aria-label="Alternar menu">
            <i class="bi bi-list"></i> Menu
        </button>

        <!-- Stock Section -->
        <div id="stockSection" class="section active">
            <h2>Estoque</h2>
            <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                <input type="text" id="searchInput" class="form-control w-auto flex-grow-1 me-2" placeholder="Pesquisar produtos..." aria-label="Pesquisar produtos">
                <button class="btn btn-custom" data-bs-toggle="modal" data-bs-target="#addProductModal" onclick="prepareAddProduct()" aria-label="Adicionar novo produto">
                    <i class="bi bi-plus-circle me-1"></i> Adicionar Produto
                </button>
            </div>

            <!-- Tabs -->
            <ul class="nav nav-tabs" id="stockTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="tinta-tab" data-bs-toggle="tab" data-bs-target="#tinta" type="button" role="tab" aria-controls="tinta" aria-selected="true">Tintas</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="papel-tab" data-bs-toggle="tab" data-bs-target="#papel" type="button" role="tab" aria-controls="papel" aria-selected="false">Papéis</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="tecido-tab" data-bs-toggle="tab" data-bs-target="#tecido" type="button" role="tab" aria-controls="tecido" aria-selected="false">Tecidos</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="tecido-cortado-tab" data-bs-toggle="tab" data-bs-target="#tecido-cortado" type="button" role="tab" aria-controls="tecido-cortado" aria-selected="false">Tecidos Cortados</button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content mt-3" id="stockTabContent">
                <!-- Tinta Table -->
                <div class="tab-pane fade show active" id="tinta" role="tabpanel" aria-labelledby="tinta-tab">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">Cor</th>
                                    <th scope="col">Tipo</th>
                                    <th scope="col">Quantidade (Frascos)</th>
                                    <th scope="col">Litros por Frasco</th>
                                    <th scope="col">Total Litros</th>
                                    <th scope="col">Quantidade Mínima</th>
                                    <th scope="col" class="text-end">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tintaTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Papel Table -->
                <div class="tab-pane fade" id="papel" role="tabpanel" aria-labelledby="papel-tab">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">Tipo</th>
                                    <th scope="col">Quantidade (Rolos)</th>
                                    <th scope="col">Metros por Rolo</th>
                                    <th scope="col">Total Metros</th>
                                    <th scope="col">Quantidade Mínima</th>
                                    <th scope="col" class="text-end">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="papelTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Tecido Table -->
                <div class="tab-pane fade" id="tecido" role="tabpanel" aria-labelledby="tecido-tab">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">Tipo</th>
                                    <th scope="col">Quantidade (Metros)</th>
                                    <th scope="col">Largura (cm)</th>
                                    <th scope="col">Quantidade Mínima</th>
                                    <th scope="col" class="text-end">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tecidoTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Tecido Cortado Table -->
                <div class="tab-pane fade" id="tecido-cortado" role="tabpanel" aria-labelledby="tecido-cortado-tab">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">Tipo</th>
                                    <th scope="col">Quantidade</th>
                                    <th scope="col">Medida (LxA, cm)</th>
                                    <th scope="col">Quantidade Mínima</th>
                                    <th scope="col" class="text-end">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tecidoCortadoTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Entry Section -->
        <div id="entrySection" class="section">
            <h2>Entrada de Estoque</h2>
            <form id="entryForm" class="needs-validation" novalidate>
                <div class="mb-3">
                    <label for="entryProduct" class="form-label">Produto</label>
                    <select class="form-select" id="entryProduct" required aria-describedby="entryProductFeedback">
                        <option value="" disabled selected>Selecione um produto</option>
                    </select>
                    <div id="entryProductFeedback" class="invalid-feedback">Selecione um produto.</div>
                </div>
                <div class="mb-3">
                    <label for="entryQuantity" class="form-label">Quantidade</label>
                    <input type="number" step="0.01" class="form-control" id="entryQuantity" min="0.01" required aria-describedby="entryQuantityFeedback">
                    <div id="entryQuantityFeedback" class="invalid-feedback">Digite uma quantidade válida (maior que 0).</div>
                </div>
                <div class="mb-3">
                    <label for="entrySupplier" class="form-label">Fornecedor</label>
                    <select class="form-select" id="entrySupplier" required aria-describedby="entrySupplierFeedback">
                        <option value="" disabled selected>Selecione um fornecedor</option>
                    </select>
                    <div id="entrySupplierFeedback" class="invalid-feedback">Selecione um fornecedor.</div>
                </div>
                <button type="submit" class="btn btn-custom">Registrar Entrada</button>
            </form>
        </div>

        <!-- Exit Section -->
        <div id="exitSection" class="section">
            <h2>Saída de Estoque</h2>
            <form id="exitForm" class="needs-validation" novalidate>
                <div class="mb-3">
                    <label for="exitProduct" class="form-label">Produto</label>
                    <select class="form-select" id="exitProduct" required aria-describedby="exitProductFeedback">
                        <option value="" disabled selected>Selecione um produto</option>
                    </select>
                    <div id="exitProductFeedback" class="invalid-feedback">Selecione um produto.</div>
                </div>
                <div class="mb-3">
                    <label for="exitQuantity" class="form-label">Quantidade</label>
                    <input type="number" step="0.01" class="form-control" id="exitQuantity" min="0.01" required aria-describedby="exitQuantityFeedback">
                    <div id="exitQuantityFeedback" class="invalid-feedback">Digite uma quantidade válida (maior que 0).</div>
                </div>
                <button type="submit" class="btn btn-custom">Registrar Saída</button>
            </form>
        </div>

        <!-- Suppliers Section -->
        <div id="suppliersSection" class="section">
            <h2>Fornecedores</h2>
            <button class="btn btn-custom mb-3" data-bs-toggle="modal" data-bs-target="#addSupplierModal" aria-label="Adicionar novo fornecedor">
                <i class="bi bi-plus-circle me-1"></i> Adicionar Fornecedor
            </button>
            <div class="table-responsive">
                <table class="table table-striped table-hover table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col">Nome</th>
                            <th scope="col">Telefone</th>
                            <th scope="col">Email</th>
                            <th scope="col" class="text-end">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="suppliersTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Orders Section -->
        <div id="ordersSection" class="section">
            <h2>Pedidos</h2>
            <form id="orderForm" class="needs-validation" novalidate>
                <div class="mb-3">
                    <label for="orderProduct" class="form-label">Produto</label>
                    <select class="form-select" id="orderProduct" required aria-describedby="orderProductFeedback">
                        <option value="" disabled selected>Selecione um produto</option>
                    </select>
                    <div id="orderProductFeedback" class="invalid-feedback">Selecione um produto.</div>
                </div>
                <div class="mb-3">
                    <label for="orderQuantity" class="form-label">Quantidade</label>
                    <input type="number" step="0.01" class="form-control" id="orderQuantity" min="0.01" required aria-describedby="orderQuantityFeedback">
                    <div id="orderQuantityFeedback" class="invalid-feedback">Digite uma quantidade válida (maior que 0).</div>
                </div>
                <div class="mb-3">
                    <label for="orderSupplier" class="form-label">Fornecedor</label>
                    <select class="form-select" id="orderSupplier" required aria-describedby="orderSupplierFeedback">
                        <option value="" disabled selected>Selecione um fornecedor</option>
                    </select>
                    <div id="orderSupplierFeedback" class="invalid-feedback">Selecione um fornecedor.</div>
                </div>
                <button type="submit" class="btn btn-custom">Gerar Pedido</button>
            </form>
        </div>

        <!-- Charts Section -->
        <div id="chartsSection" class="section">
            <h2>Gráficos</h2>
            <div class="chart-container">
                <canvas id="stockChart" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- Add/Edit Product Modal -->
        <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addProductModalLabel">Adicionar Produto</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addProductForm" class="needs-validation" novalidate>
                            <input type="hidden" id="editProductId">
                            <input type="hidden" id="editProductCategory">
                            <div class="mb-3">
                                <label for="productCategory" class="form-label">Categoria</label>
                                <select class="form-select" id="productCategory" required aria-describedby="productCategoryFeedback">
                                    <option value="" disabled selected>Selecione uma categoria</option>
                                    <option value="tinta">Tinta</option>
                                    <option value="papel">Papel</option>
                                    <option value="tecido">Tecido</option>
                                    <option value="tecido-cortado">Tecido Cortado</option>
                                </select>
                                <div id="productCategoryFeedback" class="invalid-feedback">Selecione uma categoria.</div>
                            </div>

                            <!-- Tinta Form -->
                            <div id="form-tinta" class="hidden-form">
                                <div class="mb-3">
                                    <label for="typeColor" class="form-label">Cor</label>
                                    <select class="form-select" id="typeColor" required aria-describedby="typeColorFeedback">
                                        <option value="" disabled selected>Selecione a Cor</option>
                                        <option value="cyan">Cyan</option>
                                        <option value="magenta">Magenta</option>
                                        <option value="amarelo">Amarelo</option>
                                        <option value="preto">Preto</option>
                                    </select>
                                    <div id="typeColorFeedback" class="invalid-feedback">Selecione uma cor.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="typeTinta" class="form-label">Tipo</label>
                                    <select class="form-select" id="typeTinta" required aria-describedby="typeTintaFeedback">
                                        <option value="" disabled selected>Selecione o Tipo</option>
                                        <option value="sublimacao">Sublimação</option>
                                        <option value="pigmentada">Pigmentada</option>
                                    </select>
                                    <div id="typeTintaFeedback" class="invalid-feedback">Selecione um tipo.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="productQty" class="form-label">Quantidade (Frascos)</label>
                                    <input type="number" class="form-control" id="productQty" min="1" required aria-describedby="productQtyFeedback">
                                    <div id="productQtyFeedback" class="invalid-feedback">Digite uma quantidade válida (maior que 0).</div>
                                </div>
                                <div class="mb-3">
                                    <label for="productQtyLitros" class="form-label">Litros por Frasco</label>
                                    <input type="number" step="0.01" class="form-control" id="productQtyLitros" min="0.01" required aria-describedby="productQtyLitrosFeedback">
                                    <div id="productQtyLitrosFeedback" class="invalid-feedback">Digite uma quantidade válida (maior que 0).</div>
                                </div>
                                <div class="mb-3">
                                    <label for="productQtyMin" class="form-label">Quantidade Mínima</label>
                                    <input type="number" step="0.01" class="form-control" id="productQtyMin" min="0" aria-describedby="productQtyMinFeedback">
                                    <div id="productQtyMinFeedback" class="invalid-feedback">Digite uma quantidade válida (0 ou maior).</div>
                                </div>
                            </div>

                            <!-- Papel Form -->
                            <div id="form-papel" class="hidden-form">
                                <div class="mb-3">
                                    <label for="typePapel" class="form-label">Tipo</label>
                                    <select class="form-select" id="typePapel" required aria-describedby="typePapelFeedback">
                                        <option value="" disabled selected>Selecione o Tipo</option>
                                        <option value="papel1">Art 45gr 160x250</option>
                                        <option value="papel2">Art 45gr 180x400</option>
                                        <option value="papel3">Art 45gr 160x1000</option>
                                        <option value="papel4">Coldenhove 40gr 162x400</option>
                                        <option value="papel5">Seda 20gr 160x1000</option>
                                        <option value="papel6">Kraft 35gr 160x500</option>
                                    </select>
                                    <div id="typePapelFeedback" class="invalid-feedback">Selecione um tipo.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="productQtyUnit" class="form-label">Quantidade (Rolos)</label>
                                    <input type="number" class="form-control" id="productQtyUnit" min="1" required aria-describedby="productQtyUnitFeedback">
                                    <div id="productQtyUnitFeedback" class="invalid-feedback">Digite uma quantidade válida (maior que 0).</div>
                                </div>
                                <div class="mb-3">
                                    <label for="productQtyMetros" class="form-label">Metros por Rolo</label>
                                    <input type="number" class="form-control" id="productQtyMetros" min="1" required aria-describedby="productQtyMetrosFeedback">
                                    <div id="productQtyMetrosFeedback" class="invalid-feedback">Digite uma quantidade válida (maior que 0).</div>
                                </div>
                                <div class="mb-3">
                                    <label for="productQtyMin" class="form-label">Quantidade Mínima</label>
                                    <input type="number" step="0.01" class="form-control" id="productQtyMin" min="0" aria-describedby="productQtyMinFeedback">
                                    <div id="productQtyMinFeedback" class="invalid-feedback">Digite uma quantidade válida (0 ou maior).</div>
                                </div>
                            </div>

                            <!-- Tecido Form -->
                            <div id="form-tecido" class="hidden-form">
                                <div class="mb-3">
                                    <label for="typeTecido" class="form-label">Tipo</label>
                                    <input type="text" class="form-control" id="typeTecido" required aria-describedby="typeTecidoFeedback">
                                    <div id="typeTecidoFeedback" class="invalid-feedback">Digite o tipo do tecido.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="productQtyMetrosTecido" class="form-label">Quantidade (Metros)</label>
                                    <input type="number" step="0.01" class="form-control" id="productQtyMetrosTecido" min="0.01" required aria-describedby="productQtyMetrosTecidoFeedback">
                                    <div id="productQtyMetrosTecidoFeedback" class="invalid-feedback">Digite uma quantidade válida (maior que 0).</div>
                                </div>
                                <div class="mb-3">
                                    <label for="productWidth" class="form-label">Largura (cm)</label>
                                    <input type="number" step="0.01" class="form-control" id="productWidth" min="0.01" required aria-describedby="productWidthFeedback">
                                    <div id="productWidthFeedback" class="invalid-feedback">Digite uma largura válida (maior que 0).</div>
                                </div>
                                <div class="mb-3">
                                    <label for="productQtyMin" class="form-label">Quantidade Mínima</label>
                                    <input type="number" step="0.01" class="form-control" id="productQtyMin" min="0" aria-describedby="productQtyMinFeedback">
                                    <div id="productQtyMinFeedback" class="invalid-feedback">Digite uma quantidade válida (0 ou maior).</div>
                                </div>
                            </div>

                            <!-- Tecido Cortado Form -->
                            <div id="form-tecido-cortado" class="hidden-form">
                                <div class="mb-3">
                                    <label for="typeTecidoCortado" class="form-label">Tipo</label>
                                    <select class="form-select" id="typeTecidoCortado" required aria-describedby="typeTecidoCortadoFeedback">
                                        <option value="" disabled selected>Selecione o Tipo</option>
                                        <option value="malha">Malha</option>
                                        <option value="tactel">Tactel</option>
                                    </select>
                                    <div id="typeTecidoCortadoFeedback" class="invalid-feedback">Selecione um tipo.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="productQtyTecidoCortado" class="form-label">Quantidade</label>
                                    <input type="number" class="form-control" id="productQtyTecidoCortado" min="1" required aria-describedby="productQtyTecidoCortadoFeedback">
                                    <div id="productQtyTecidoCortadoFeedback" class="invalid-feedback">Digite uma quantidade válida (maior que 0).</div>
                                </div>
                                <div class="mb-3">
                                    <label for="productMedida" class="form-label">Medida (Largura x Altura, cm)</label>
                                    <div class="row g-2">
                                        <div class="col">
                                            <input type="number" step="0.01" class="form-control" id="productMedidaLargura" placeholder="Largura" min="0.01" required aria-describedby="productMedidaLarguraFeedback">
                                            <div id="productMedidaLarguraFeedback" class="invalid-feedback">Digite uma largura válida.</div>
                                        </div>
                                        <div class="col-auto d-flex align-items-center">x</div>
                                        <div class="col">
                                            <input type="number" step="0.01" class="form-control" id="productMedidaAltura" placeholder="Altura" min="0.01" required aria-describedby="productMedidaAlturaFeedback">
                                            <div id="productMedidaAlturaFeedback" class="invalid-feedback">Digite uma altura válida.</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="productQtyMin" class="form-label">Quantidade Mínima</label>
                                    <input type="number" step="0.01" class="form-control" id="productQtyMin" min="0" aria-describedby="productQtyMinFeedback">
                                    <div id="productQtyMinFeedback" class="invalid-feedback">Digite uma quantidade válida (0 ou maior).</div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Cancelar">Cancelar</button>
                                <button type="submit" class="btn btn-custom">Salvar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Supplier Modal -->
        <div class="modal fade" id="addSupplierModal" tabindex="-1" aria-labelledby="addSupplierModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addSupplierModalLabel">Adicionar Fornecedor</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addSupplierForm" class="needs-validation" novalidate>
                            <div class="mb-3">
                                <label for="supplierName" class="form-label">Nome</label>
                                <input type="text" class="form-control" id="supplierName" required aria-describedby="supplierNameFeedback">
                                <div id="supplierNameFeedback" class="invalid-feedback">Digite o nome do fornecedor.</div>
                            </div>
                            <div class="mb-3">
                                <label for="supplierPhone" class="form-label">Telefone</label>
                                <input type="tel" class="form-control" id="supplierPhone" required aria-describedby="supplierPhoneFeedback" pattern="\+?\d{10,15}">
                                <div id="supplierPhoneFeedback" class="invalid-feedback">Digite um telefone válido (10 a 15 dígitos).</div>
                            </div>
                            <div class="mb-3">
                                <label for="supplierEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="supplierEmail" required aria-describedby="supplierEmailFeedback">
                                <div id="supplierEmailFeedback" class="invalid-feedback">Digite um email válido.</div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Cancelar">Cancelar！

                                <button type="submit" class="btn btn-custom">Salvar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        const API_URL = "https://estoque-v4-production.up.railway.app";
        const paperTypeMap = {
            papel1: "Art 45gr 160x250",
            papel2: "Art 45gr 180x400",
            papel3: "Art 45gr 160x1000",
            papel4: "Coldenhove 40gr 162x400",
            papel5: "Seda 20gr 160x1000",
            papel6: "Kraft 35gr 160x500"
        };

        // Initialize Chart.js
        let stockChartInstance = null;
        function initializeChart() {
            const ctx = document.getElementById('stockChart').getContext('2d');
            stockChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Tintas', 'Papéis', 'Tecidos', 'Tecidos Cortados'],
                    datasets: [{
                        label: 'Quantidade Total',
                        data: [0, 0, 0, 0],
                        backgroundColor: ['#007bff', '#28a745', '#ffc107', '#dc3545'],
                        borderColor: ['#0056b3', '#218838', '#e0a800', '#c82333'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Quantidade' }
                        },
                        x: {
                            title: { display: true, text: 'Categoria' }
                        }
                    },
                    plugins: {
                        legend: { display: true, position: 'top' },
                        title: { display: true, text: 'Resumo do Estoque' }
                    }
                }
            });
        }

        async function updateChart() {
            try {
                const [tintas, papeis, tecidos, tecidosCortados] = await Promise.all([
                    fetchTinta(),
                    fetchPapel(),
                    fetchTecido(),
                    fetchTecidoCortado()
                ]);

                const totalTintas = tintas.reduce((sum, tinta) => sum + (tinta.productQty * tinta.productQtyLitros || 0), 0);
                const totalPapeis = papeis.reduce((sum, papel) => sum + (papel.qtyUnit * papel.qtyMetros || 0), 0);
                const totalTecidos = tecidos.reduce((sum, tecido) => sum + (tecido.qtyMetros || 0), 0);
                const totalTecidosCortados = tecidosCortados.reduce((sum, tecido) => sum + (tecido.quantity || 0), 0);

                if (stockChartInstance) {
                    stockChartInstance.data.datasets[0].data = [totalTintas, totalPapeis, totalTecidos, totalTecidosCortados];
                    stockChartInstance.update();
                }
            } catch (error) {
                console.error('Erro ao atualizar gráfico:', error);
                showAlert('Erro ao carregar dados do gráfico', 'danger');
            }
        }

        // Show alert
        function showAlert(message, type = 'success') {
            const alertContainer = document.createElement('div');
            alertContainer.className = `alert alert-${type} alert-dismissible fade show`;
            alertContainer.role = 'alert';
            alertContainer.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
            `;
            document.body.appendChild(alertContainer);
            setTimeout(() => alertContainer.remove(), 5000);
        }

        // Fetch data
        async function fetchTinta() {
            try {
                const response = await fetch(`${API_URL}/products-tinta`);
                if (!response.ok) throw new Error("Falha ao buscar tintas");
                return await response.json();
            } catch (error) {
                console.error(error);
                showAlert('Erro ao carregar tintas', 'danger');
                return [];
            }
        }

        async function fetchPapel() {
            try {
                const response = await fetch(`${API_URL}/products-papel`);
                if (!response.ok) throw new Error("Falha ao buscar papéis");
                return await response.json();
            } catch (error) {
                console.error(error);
                showAlert('Erro ao carregar papéis', 'danger');
                return [];
            }
        }

        async function fetchTecido() {
            try {
                const response = await fetch(`${API_URL}/products-tecido`);
                if (!response.ok) throw new Error("Falha ao buscar tecidos");
                return await response.json();
            } catch (error) {
                console.error(error);
                showAlert('Erro ao carregar tecidos', 'danger');
                return [];
            }
        }

        async function fetchTecidoCortado() {
            try {
                const response = await fetch(`${API_URL}/products-tecido-cortado`);
                if (!response.ok) throw new Error("Falha ao buscar tecidos cortados");
                return await response.json();
            } catch (error) {
                console.error(error);
                showAlert('Erro ao carregar tecidos cortados', 'danger');
                return [];
            }
        }

        async function fetchSuppliers() {
            try {
                const response = await fetch(`${API_URL}/suppliers`);
                if (!response.ok) throw new Error("Falha ao buscar fornecedores");
                return await response.json();
            } catch (error) {
                console.error(error);
                showAlert('Erro ao carregar fornecedores', 'danger');
                return [];
            }
        }

        async function fetchProduct(category, id) {
            try {
                const response = await fetch(`${API_URL}/products-${category}/${id}`);
                if (!response.ok) throw new Error(`Falha ao buscar ${category} ${id}`);
                return await response.json();
            } catch (error) {
                console.error(error);
                showAlert(`Erro ao carregar ${category}`, 'danger');
                return null;
            }
        }

        // Render tables
        async function renderTintaTable() {
            const tintas = await fetchTinta();
            const tableBody = document.getElementById("tintaTableBody");
            tableBody.innerHTML = "";
            if (tintas.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">Nenhum dado encontrado</td></tr>';
                return;
            }
            tintas.forEach(tinta => {
                const totalLitros = (tinta.productQty * tinta.productQtyLitros).toFixed(2);
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${tinta.color || '-'}</td>
                    <td>${tinta.type || '-'}</td>
                    <td>${tinta.productQty || 0}</td>
                    <td>${tinta.productQtyLitros || 0}</td>
                    <td>${totalLitros}</td>
                    <td>${tinta.qtyMin || 0}</td>
                    <td class="text-end">
                        <button class="btn btn-outline-primary btn-sm me-1" onclick="editProduct('tinta', ${tinta.id})" title="Editar tinta" aria-label="Editar tinta">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm" onclick="removeProduct('tinta', ${tinta.id})" title="Remover tinta" aria-label="Remover tinta">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        async function renderPapelTable() {
            const papeis = await fetchPapel();
            const tableBody = document.getElementById("papelTableBody");
            tableBody.innerHTML = "";
            if (papeis.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">Nenhum dado encontrado</td></tr>';
                return;
            }
            papeis.forEach(papel => {
                const displayName = paperTypeMap[papel.type] || papel.type;
                const totalMetros = (papel.qtyUnit * papel.qtyMetros).toFixed(2);
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${displayName || '-'}</td>
                    <td>${papel.qtyUnit || 0}</td>
                    <td>${papel.qtyMetros || 0}</td>
                    <td>${totalMetros}</td>
                    <td>${papel.qtyMin || 0}</td>
                    <td class="text-end">
                        <button class="btn btn-outline-primary btn-sm me-1" onclick="editProduct('papel', ${papel.id})" title="Editar papel" aria-label="Editar papel">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm" onclick="removeProduct('papel', ${papel.id})" title="Remover papel" aria-label="Remover papel">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        async function renderTecidoTable() {
            const tecidos = await fetchTecido();
            const tableBody = document.getElementById("tecidoTableBody");
            tableBody.innerHTML = "";
            if (tecidos.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center">Nenhum dado encontrado</td></tr>';
                return;
            }
            tecidos.forEach(tecido => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${tecido.type || '-'}</td>
                    <td>${tecido.qtyMetros || 0}</td>
                    <td>${tecido.width || 0}</td>
                    <td>${tecido.qtyMin || 0}</td>
                    <td class="text-end">
                        <button class="btn btn-outline-primary btn-sm me-1" onclick="editProduct('tecido', ${tecido.id})" title="Editar tecido" aria-label="Editar tecido">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm" onclick="removeProduct('tecido', ${tecido.id})" title="Remover tecido" aria-label="Remover tecido">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        async function renderTecidoCortadoTable() {
            const tecidosCortados = await fetchTecidoCortado();
            const tableBody = document.getElementById("tecidoCortadoTableBody");
            tableBody.innerHTML = "";
            if (tecidosCortados.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center">Nenhum dado encontrado</td></tr>';
                return;
            }
            tecidosCortados.forEach(tecido => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${tecido.type || '-'}</td>
                    <td>${tecido.quantity || 0}</td>
                    <td>${tecido.measurement || '-'}</td>
                    <td>${tecido.qtyMin || 0}</td>
                    <td class="text-end">
                        <button class="btn btn-outline-primary btn-sm me-1" onclick="editProduct('tecido-cortado', ${tecido.id})" title="Editar tecido cortado" aria-label="Editar tecido cortado">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm" onclick="removeProduct('tecido-cortado', ${tecido.id})" title="Remover tecido cortado" aria-label="Remover tecido cortado">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        async function renderSuppliers() {
            const suppliers = await fetchSuppliers();
            const tableBody = document.getElementById("suppliersTableBody");
            tableBody.innerHTML = "";
            if (suppliers.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center">Nenhum fornecedor encontrado</td></tr>';
                return;
            }
            suppliers.forEach(supplier => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${supplier.name || '-'}</td>
                    <td>${supplier.phone || '-'}</td>
                    <td>${supplier.email || '-'}</td>
                    <td class="text-end">
                        <button class="btn btn-outline-danger btn-sm" onclick="removeSupplier(${supplier.id})" title="Remover fornecedor" aria-label="Remover fornecedor">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Form validation
        function validateForm(formId) {
            const form = document.getElementById(formId);
            form.classList.add('was-validated');
            return form.checkValidity();
        }

        // Edit product
        async function editProduct(category, id) {
            const product = await fetchProduct(category, id);
            if (!product) return;

            document.getElementById("addProductModalLabel").textContent = `Editar ${category.charAt(0).toUpperCase() + category.slice(1)}`;
            document.getElementById("editProductId").value = id;
            document.getElementById("editProductCategory").value = category;
            document.getElementById("productCategory").value = category;
            document.getElementById("productCategory").dispatchEvent(new Event('change'));

            if (category === "tinta") {
                document.getElementById("typeColor").value = product.color || '';
                document.getElementById("typeTinta").value = product.type || '';
                document.getElementById("productQty").value = product.productQty || '';
                document.getElementById("productQtyLitros").value = product.productQtyLitros || '';
                document.getElementById("productQtyMin").value = product.qtyMin || '';
            } else if (category === "papel") {
                document.getElementById("typePapel").value = product.type || '';
                document.getElementById("productQtyUnit").value = product.qtyUnit || '';
                document.getElementById("productQtyMetros").value = product.qtyMetros || '';
                document.getElementById("productQtyMin").value = product.qtyMin || '';
            } else if (category === "tecido") {
                document.getElementById("typeTecido").value = product.type || '';
                document.getElementById("productQtyMetrosTecido").value = product.qtyMetros || '';
                document.getElementById("productWidth").value = product.width || '';
                document.getElementById("productQtyMin").value = product.qtyMin || '';
            } else if (category === "tecido-cortado") {
                document.getElementById("typeTecidoCortado").value = product.type || '';
                document.getElementById("productQtyTecidoCortado").value = product.quantity || '';
                if (product.measurement && product.measurement.includes('x')) {
                    const [width, height] = product.measurement.split('x').map(parseFloat);
                    document.getElementById("productMedidaLargura").value = width || '';
                    document.getElementById("productMedidaAltura").value = height || '';
                } else {
                    document.getElementById("productMedidaLargura").value = '';
                    document.getElementById("productMedidaAltura").value = '';
                }
                document.getElementById("productQtyMin").value = product.qtyMin || '';
            }

            const modal = new bootstrap.Modal(document.getElementById("addProductModal"));
            modal.show();
        }

        // Save product
        async function saveProduct(event) {
            event.preventDefault();
            if (!validateForm('addProductForm')) return;

            const editId = document.getElementById("editProductId").value;
            const category = editId ? document.getElementById("editProductCategory").value : document.getElementById("productCategory").value;

            try {
                let product, endpoint, categoryName, method;
                if (category === "tinta") {
                    const color = document.getElementById("typeColor").value;
                    const type = document.getElementById("typeTinta").value;
                    const productQty = parseInt(document.getElementById("productQty").value);
                    const productQtyLitros = parseFloat(document.getElementById("productQtyLitros").value);
                    const qtyMin = parseFloat(document.getElementById("productQtyMin").value) || 0;

                    product = { color, type, productQty, productQtyLitros, qtyMin };
                    endpoint = editId ? `${API_URL}/products-tinta/${editId}` : `${API_URL}/products-tinta`;
                    categoryName = "tinta";
                } else if (category === "papel") {
                    const type = document.getElementById("typePapel").value;
                    const qtyUnit = parseInt(document.getElementById("productQtyUnit").value);
                    const qtyMetros = parseInt(document.getElementById("productQtyMetros").value);
                    const qtyMin = parseFloat(document.getElementById("productQtyMin").value) || 0;

                    product = { type, qtyUnit, qtyMetros, qtyMin };
                    endpoint = editId ? `${API_URL}/products-papel/${editId}` : `${API_URL}/products-papel`;
                    categoryName = "papel";
                } else if (category === "tecido") {
                    const type = document.getElementById("typeTecido").value;
                    const qtyMetros = parseFloat(document.getElementById("productQtyMetrosTecido").value);
                    const width = parseFloat(document.getElementById("productWidth").value);
                    const qtyMin = parseFloat(document.getElementById("productQtyMin").value) || 0;

                    product = { type, qtyMetros, width, qtyMin };
                    endpoint = editId ? `${API_URL}/products-tecido/${editId}` : `${API_URL}/products-tecido`;
                    categoryName = "tecido";
                } else if (category === "tecido-cortado") {
                    const type = document.getElementById("typeTecidoCortado").value;
                    const quantity = parseInt(document.getElementById("productQtyTecidoCortado").value);
                    const medidaLargura = parseFloat(document.getElementById("productMedidaLargura").value);
                    const medidaAltura = parseFloat(document.getElementById("productMedidaAltura").value);
                    const qtyMin = parseFloat(document.getElementById("productQtyMin").value) || 0;

                    const measurement = `${medidaLargura}x${medidaAltura}`;
                    product = { type, quantity, measurement, qtyMin };
                    endpoint = editId ? `${API_URL}/products-tecido-cortado/${editId}` : `${API_URL}/products-tecido-cortado`;
                    categoryName = "tecido-cortado";
                } else {
                    throw new Error("Categoria inválida selecionada");
                }

                method = editId ? "PUT" : "POST";
                const response = await fetch(endpoint, {
                    method,
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(product)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || `Falha ao ${editId ? 'editar' : 'adicionar'} ${categoryName}`);
                }

                document.getElementById("addProductForm").reset();
                document.getElementById("editProductId").value = "";
                document.getElementById("editProductCategory").value = "";
                const modal = bootstrap.Modal.getInstance(document.getElementById("addProductModal"));
                modal.hide();

                if (categoryName === "tinta") await renderTintaTable();
                else if (categoryName === "papel") await renderPapelTable();
                else if (categoryName === "tecido") await renderTecidoTable();
                else if (categoryName === "tecido-cortado") await renderTecidoCortadoTable();

                await updateProductSelects();
                await updateChart();
                showAlert(`${categoryName.charAt(0).toUpperCase() + categoryName.slice(1)} ${editId ? 'editado' : 'adicionado'} com sucesso!`);
            } catch (error) {
                console.error(error);
                showAlert(`Erro: ${error.message}`, 'danger');
            }
        }

        // Remove product
        async function removeProduct(category, id) {
            if (!confirm(`Tem certeza que deseja remover este ${category}?`)) return;
            try {
                const endpoint = `${API_URL}/products-${category}/${id}`;
                const response = await fetch(endpoint, { method: "DELETE" });
                if (!response.ok) throw new Error(`Falha ao remover ${category}`);
                if (category === "tinta") await renderTintaTable();
                else if (category === "papel") await renderPapelTable();
                else if (category === "tecido") await renderTecidoTable();
                else if (category === "tecido-cortado") await renderTecidoCortadoTable();
                await updateProductSelects();
                await updateChart();
                showAlert(`${category.charAt(0).toUpperCase() + category.slice(1)} removido com sucesso!`);
            } catch (error) {
                console.error(error);
                showAlert(`Erro ao remover ${category}: ${error.message}`, 'danger');
            }
        }

        // Handle stock entry
        async function handleStockEntry(event) {
            event.preventDefault();
            if (!validateForm('entryForm')) return;

            try {
                const productSelect = document.getElementById("entryProduct").value;
                const quantity = parseFloat(document.getElementById("entryQuantity").value);
                const supplierId = document.getElementById("entrySupplier").value;

                const [category, productId] = productSelect.split('_');
                const entry = {
                    category,
                    product_id: parseInt(productId),
                    quantity,
                    supplier_id: parseInt(supplierId)
                };

                const response = await fetch(`${API_URL}/entries`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(entry)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || "Falha ao registrar entrada");
                }

                document.getElementById("entryForm").reset();
                document.getElementById("entryForm").classList.remove('was-validated');
                if (category === "tinta") await renderTintaTable();
                else if (category === "papel") await renderPapelTable();
                else if (category === "tecido") await renderTecidoTable();
                else if (category === "tecido-cortado") await renderTecidoCortadoTable();
                await updateChart();
                showAlert("Entrada registrada com sucesso!");
            } catch (error) {
                console.error(error);
                showAlert(`Erro ao registrar entrada: ${error.message}`, 'danger');
            }
        }

        // Handle stock exit
        async function handleStockExit(event) {
            event.preventDefault();
            if (!validateForm('exitForm')) return;

            try {
                const productSelect = document.getElementById("exitProduct").value;
                const quantity = parseFloat(document.getElementById("exitQuantity").value);

                const [category, productId] = productSelect.split('_');
                const exit = {
                    category,
                    product_id: parseInt(productId),
                    quantity
                };

                const response = await fetch(`${API_URL}/exits`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(exit)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || "Falha ao registrar saída");
                }

                document.getElementById("exitForm").reset();
                document.getElementById("exitForm").classList.remove('was-validated');
                if (category === "tinta") await renderTintaTable();
                else if (category === "papel") await renderPapelTable();
                else if (category === "tecido") await renderTecidoTable();
                else if (category === "tecido-cortado") await renderTecidoCortadoTable();
                await updateChart();
                showAlert("Saída registrada com sucesso!");
            } catch (error) {
                console.error(error);
                showAlert(`Erro ao registrar saída: ${error.message}`, 'danger');
            }
        }

        // Handle order submission
        async function handleOrderSubmission(event) {
            event.preventDefault();
            if (!validateForm('orderForm')) return;

            try {
                const productSelect = document.getElementById("orderProduct").value;
                const quantity = parseFloat(document.getElementById("orderQuantity").value);
                const supplierId = document.getElementById("orderSupplier").value;

                const [category, productId] = productSelect.split('_');
                const order = {
                    category,
                    product_id: parseInt(productId),
                    quantity,
                    supplier_id: parseInt(supplierId)
                };

                const response = await fetch(`${API_URL}/orders`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(order)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || "Falha ao gerar pedido");
                }

                document.getElementById("orderForm").reset();
                document.getElementById("orderForm").classList.remove('was-validated');
                showAlert("Pedido gerado com sucesso!");
            } catch (error) {
                console.error(error);
                showAlert(`Erro ao gerar pedido: ${error.message}`, 'danger');
            }
        }

        // Search functionality
        document.getElementById("searchInput").addEventListener("input", async function () {
            const query = this.value.toLowerCase();
            const activeTab = document.querySelector("#stockTabs .nav-link.active").id;

            if (activeTab === "tinta-tab") {
                const tintas = await fetchTinta();
                const filtered = tintas.filter(tinta => 
                    (tinta.color || '').toLowerCase().includes(query) || 
                    (tinta.type || '').toLowerCase().includes(query)
                );
                const tableBody = document.getElementById("tintaTableBody");
                tableBody.innerHTML = "";
                if (filtered.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center">Nenhum dado encontrado</td></tr>';
                    return;
                }
                filtered.forEach(tinta => {
                    const totalLitros = (tinta.productQty * tinta.productQtyLitros).toFixed(2);
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${tinta.color || '-'}</td>
                        <td>${tinta.type || '-'}</td>
                        <td>${tinta.productQty || 0}</td>
                        <td>${tinta.productQtyLitros || 0}</td>
                        <td>${totalLitros}</td>
                        <td>${tinta.qtyMin || 0}</td>
                        <td class="text-end">
                            <button class="btn btn-outline-primary btn-sm me-1" onclick="editProduct('tinta', ${tinta.id})" title="Editar tinta" aria-label="Editar tinta">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="removeProduct('tinta', ${tinta.id})" title="Remover tinta" aria-label="Remover tinta">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } else if (activeTab === "papel-tab") {
                const papeis = await fetchPapel();
                const filtered = papeis.filter(papel => 
                    (paperTypeMap[papel.type] || papel.type || '').toLowerCase().includes(query)
                );
                const tableBody = document.getElementById("papelTableBody");
                tableBody.innerHTML = "";
                if (filtered.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center">Nenhum dado encontrado</td></tr>';
                    return;
                }
                filtered.forEach(papel => {
                    const displayName = paperTypeMap[papel.type] || papel.type;
                    const totalMetros = (papel.qtyUnit * papel.qtyMetros).toFixed(2);
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${displayName || '-'}</td>
                        <td>${papel.qtyUnit || 0}</td>
                        <td>${papel.qtyMetros || 0}</td>
                        <td>${totalMetros}</td>
                        <td>${papel.qtyMin || 0}</td>
                        <td class="text-end">
                            <button class="btn btn-outline-primary btn-sm me-1" onclick="editProduct('papel', ${papel.id})" title="Editar papel" aria-label="Editar papel">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="removeProduct('papel', ${papel.id})" title="Remover papel" aria-label="Remover papel">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } else if (activeTab === "tecido-tab") {
                const tecidos = await fetchTecido();
                const filtered = tecidos.filter(tecido => 
                    (tecido.type || '').toLowerCase().includes(query)
                );
                const tableBody = document.getElementById("tecidoTableBody");
                tableBody.innerHTML = "";
                if (filtered.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="text-center">Nenhum dado encontrado</td></tr>';
                    return;
                }
                filtered.forEach(tecido => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${tecido.type || '-'}</td>
                        <td>${tecido.qtyMetros || 0}</td>
                        <td>${tecido.width || 0}</td>
                        <td>${tecido.qtyMin || 0}</td>
                        <td class="text-end">
                            <button class="btn btn-outline-primary btn-sm me-1" onclick="editProduct('tecido', ${tecido.id})" title="Editar tecido" aria-label="Editar tecido">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="removeProduct('tecido', ${tecido.id})" title="Remover tecido" aria-label="Remover tecido">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } else if (activeTab === "tecido-cortado-tab") {
                const tecidosCortados = await fetchTecidoCortado();
                const filtered = tecidosCortados.filter(tecido => 
                    (tecido.type || '').toLowerCase().includes(query) ||
                    (tecido.measurement || '').toLowerCase().includes(query)
                );
                const tableBody = document.getElementById("tecidoCortadoTableBody");
                tableBody.innerHTML = "";
                if (filtered.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="text-center">Nenhum dado encontrado</td></tr>';
                    return;
                }
                filtered.forEach(tecido => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${tecido.type || '-'}</td>
                        <td>${tecido.quantity || 0}</td>
                        <td>${tecido.measurement || '-'}</td>
                        <td>${tecido.qtyMin || 0}</td>
                        <td class="text-end">
                            <button class="btn btn-outline-primary btn-sm me-1" onclick="editProduct('tecido-cortado', ${tecido.id})" title="Editar tecido cortado" aria-label="Editar tecido cortado">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="removeProduct('tecido-cortado', ${tecido.id})" title="Remover tecido cortado" aria-label="Remover tecido cortado">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        });

        // Update product selects
        async function updateProductSelects() {
            const tintas = await fetchTinta();
            const papeis = await fetchPapel();
            const tecidos = await fetchTecido();
            const tecidosCortados = await fetchTecidoCortado();
            const selects = ["entryProduct", "exitProduct", "orderProduct"];
            selects.forEach(id => {
                const select = document.getElementById(id);
                select.innerHTML = "<option value='' disabled selected>Selecione um produto</option>";
                tintas.forEach(tinta => {
                    const option = document.createElement("option");
                    option.value = `tinta_${tinta.id}`;
                    option.textContent = `Tinta: ${tinta.color} (${tinta.type})`;
                    select.appendChild(option);
                });
                papeis.forEach(papel => {
                    const option = document.createElement("option");
                    option.value = `papel_${papel.id}`;
                    option.textContent = `Papel: ${paperTypeMap[papel.type] || papel.type}`;
                    select.appendChild(option);
                });
                tecidos.forEach(tecido => {
                    const option = document.createElement("option");
                    option.value = `tecido_${tecido.id}`;
                    option.textContent = `Tecido: ${tecido.type}`;
                    select.appendChild(option);
                });
                tecidosCortados.forEach(tecido => {
                    const option = document.createElement("option");
                    option.value = `tecido-cortado_${tecido.id}`;
                    option.textContent = `Tecido Cortado: ${tecido.type} (${tecido.measurement || 'Desconhecida'})`;
                    select.appendChild(option);
                });
            });
        }

        // Supplier functions
        async function addSupplier(event) {
            event.preventDefault();
            if (!validateForm('addSupplierForm')) return;

            try {
                const name = document.getElementById("supplierName").value;
                const phone = document.getElementById("supplierPhone").value;
                const email = document.getElementById("supplierEmail").value;

                const response = await fetch(`${API_URL}/suppliers`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ name, phone, email })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || "Falha ao adicionar fornecedor");
                }

                document.getElementById("addSupplierForm").reset();
                document.getElementById("addSupplierForm").classList.remove('was-validated');
                const modal = bootstrap.Modal.getInstance(document.getElementById("addSupplierModal"));
                modal.hide();
                await renderSuppliers();
                await updateSupplierSelect();
                showAlert("Fornecedor adicionado com sucesso!");
            } catch (error) {
                console.error(error);
                showAlert(`Erro ao adicionar fornecedor: ${error.message}`, 'danger');
            }
        }

        async function removeSupplier(id) {
            if (!confirm("Tem certeza que deseja remover este fornecedor?")) return;
            try {
                const response = await fetch(`${API_URL}/suppliers/${id}`, { method: "DELETE" });
                if (!response.ok) throw new Error("Falha ao remover fornecedor");
                await renderSuppliers();
                await updateSupplierSelect();
                showAlert("Fornecedor removido com sucesso!");
            } catch (error) {
                console.error(error);
                showAlert(`Erro ao remover fornecedor: ${error.message}`, 'danger');
            }
        }

        async function updateSupplierSelect() {
            const suppliers = await fetchSuppliers();
            const selects = ["entrySupplier", "orderSupplier"];
            selects.forEach(id => {
                const select = document.getElementById(id);
                select.innerHTML = "<option value='' disabled selected>Selecione um fornecedor</option>";
                suppliers.forEach(supplier => {
                    const option = document.createElement("option");
                    option.value = supplier.id;
                    option.textContent = supplier.name;
                    select.appendChild(option);
                });
            });
        }

        // Form visibility
        document.getElementById("productCategory").addEventListener("change", () => {
            const forms = ["form-tinta", "form-papel", "form-tecido", "form-tecido-cortado"];
            forms.forEach(formId => document.getElementById(formId).classList.add("hidden-form"));
            const selectedForm = `form-${document.getElementById("productCategory").value}`;
            if (forms.includes(selectedForm)) {
                document.getElementById(selectedForm).classList.remove("hidden-form");
            }
        });

        // Tab change handling
        document.getElementById("stockTabs").addEventListener("shown.bs.tab", async function (event) {
            const target = event.target.id;
            if (target === "tinta-tab") await renderTintaTable();
            else if (target === "papel-tab") await renderPapelTable();
            else if (target === "tecido-tab") await renderTecidoTable();
            else if (target === "tecido-cortado-tab") await renderTecidoCortadoTable();
        });

        // UI functions
        function toggleSidebar() {
            const sidebar = document.getElementById("sidebar");
            const content = document.getElementById("content");
            sidebar.classList.toggle("active");
            content.classList.toggle("full");
        }

        function showSection(sectionId) {
            document.querySelectorAll(".section").forEach(section => section.classList.remove("active"));
            document.getElementById(`${sectionId}Section`).classList.add("active");
            document.querySelectorAll("#sidebar .nav-link").forEach(link => link.classList.remove("active"));
            document.querySelector(`#sidebar .nav-link[onclick*='${sectionId}']`).classList.add("active");
            if (sectionId === "stock") renderTintaTable();
            if (sectionId === "charts") updateChart();
            if (window.innerWidth <= 768) toggleSidebar();
        }

        function prepareAddProduct() {
            document.getElementById("addProductForm").reset();
            document.getElementById("addProductForm").classList.remove('was-validated');
            document.getElementById("addProductModalLabel").textContent = "Adicionar Produto";
            document.getElementById("editProductId").value = "";
            document.getElementById("editProductCategory").value = "";
            document.getElementById("productCategory").value = "";
            const forms = ["form-tinta", "form-papel", "form-tecido", "form-tecido-cortado"];
            forms.forEach(formId => document.getElementById(formId).classList.add("hidden-form"));
        }

        function logout() {
            if (confirm("Deseja sair do sistema?")) {
                // Implementar lógica de logout (ex.: limpar token, redirecionar)
                showAlert("Logout realizado com sucesso!");
            }
        }

        // Initialize
        document.addEventListener("DOMContentLoaded", async () => {
            initializeChart();
            await renderTintaTable();
            await renderSuppliers();
            await updateSupplierSelect();
            await updateProductSelects();
            await updateChart();
            showSection("stock");

            document.getElementById("addProductForm").addEventListener("submit", saveProduct);
            document.getElementById("addSupplierForm").addEventListener("submit", addSupplier);
            document.getElementById("entryForm").addEventListener("submit", handleStockEntry);
            document.getElementById("exitForm").addEventListener("submit", handleStockExit);
            document.getElementById("orderForm").addEventListener("submit", handleOrderSubmission);
        });
    </script>
</body>
</html>
